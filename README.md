# Socks keeper

## Описание проекта

**Socks keeper** — это REST API приложение для управления складом носков в магазине. Оно предоставляет возможности для учета носков, включая регистрацию прихода и отпуска, фильтрацию, сортировку, а также загрузку партий носков через файлы.

Основная цель проекта — упростить и автоматизировать управление складом носков, предоставляя гибкие инструменты для работы с данными и интеграции с другими системами.

## API

Проект предоставляет следующие API-эндпоинты:

### 1. **Регистрация прихода носков**

- **URL:** `POST /api/socks/income`
- **Описание:** Увеличивает количество носков на складе.
- **Параметры запроса:**
    - `color` (String) — цвет носков. Пример: `red`.
    - `cottonPart` (Integer) — процентное содержание хлопка (0-100). Пример: `50`.
    - `quantity` (Integer) — количество носков (>0). Пример: `100`.
- **Ответы:**
    - `200 OK` — Приход зарегистрирован успешно.
    - `400 Bad Request` — Некорректные параметры запроса.

### 2. **Регистрация отпуска носков**

- **URL:** `POST /api/socks/outcome`
- **Описание:** Уменьшает количество носков на складе, если их хватает.
- **Параметры запроса:**
    - `color` (String) — цвет носков. Пример: `red`.
    - `cottonPart` (Integer) — процентное содержание хлопка (0-100). Пример: `50`.
    - `quantity` (Integer) — количество носков (>0). Пример: `50`.
- **Ответы:**
    - `200 OK` — Отпуск зарегистрирован успешно.
    - `400 Bad Request` — Нехватка носков на складе или некорректные параметры запроса.
    - `404 Not Found` — Носки с указанными параметрами не найдены.

### 3. **Получение общего количества носков**

- **URL:** `GET /api/socks`
- **Описание:** Возвращает список носков с возможностью фильтрации и сортировки.
- **Параметры запроса:**
    - `color` (String, optional) — фильтрация по цвету. Пример: `red`.
    - `minCottonPart` (Integer, optional) — минимальное содержание хлопка. Пример: `30`.
    - `maxCottonPart` (Integer, optional) — максимальное содержание хлопка. Пример: `70`.
    - `sortBy` (String, optional) — поле для сортировки: `color` или `cottonPart`.
- **Ответы:**
    - `200 OK` — Возвращает список носков в формате JSON.
    - `400 Bad Request` — Некорректные параметры запроса.

### 4. **Обновление данных носков**

- **URL:** `PUT /api/socks/{id}`
- **Описание:** Позволяет изменить параметры носков (цвет, процент хлопка, количество).
- **Параметры пути:**
    - `id` (Long) — идентификатор носков.
- **Параметры запроса:**
    - `color` (String) — новый цвет носков.
    - `cottonPart` (Integer) — новый процент хлопка (0-100).
    - `quantity` (Integer) — новое количество носков (>0).
- **Ответы:**
    - `200 OK` — Носки успешно обновлены.
    - `400 Bad Request` — Некорректные параметры запроса.
    - `404 Not Found` — Носки с указанным ID не найдены.

### 5. **Загрузка партий носков из файла**

- **URL:** `POST /api/socks/batch`
- **Описание:** Загружает партии носков из файла (CSV).
- **Параметры:**
    - `file` (MultipartFile) — CSV-файл с партиями носков (цвет, процент хлопка, количество).
- **Ответы:**
    - `200 OK` — Файл успешно обработан.
    - `400 Bad Request` — Некорректный формат файла.
    - `500 Internal Server Error` — Ошибка обработки файла.

## Фильтрация и сортировка

- **Фильтрация:** Позволяет получить список носков по цвету, диапазону содержания хлопка.
- **Сортировка:** Поддерживаются сортировки по цвету (`color`) и проценту хлопка (`cottonPart`).

## Логирование

Для логирования операций используется библиотека SLF4J. Логируются следующие события:
- Регистрация прихода и отпуска носков.
- Ошибки при работе с файлами.
- Изменения данных носков.
- Запросы фильтрации и сортировки.

## Обработка ошибок

Централизованная обработка ошибок реализована с использованием `@ControllerAdvice`. Возможные ошибки:

1. **Некорректный формат данных**
    - `400 Bad Request`
    - Сообщение: "Некорректный формат данных: ..."

2. **Нехватка носков на складе**
    - `400 Bad Request`
    - Сообщение: "Нехватка носков на складе: ..."

3. **Ошибки при обработке файлов**
    - `500 Internal Server Error`
    - Сообщение: "Ошибка при обработке файла: ..."

## Swagger

Для документации API используется Swagger UI.
- **URL:** `http://localhost:8080/swagger-ui.html`
- **Описание:** Swagger предоставляет интерактивную документацию, которая позволяет тестировать API прямо из браузера.

## Тестирование

Для тестирования используется **Testcontainers**, что позволяет запускать интеграционные тесты с реальной базой данных PostgreSQL в изолированных Docker-контейнерах.

### Покрытие тестами

1. **Контроллеры:**
    - Тесты проверяют корректность работы всех API-эндпоинтов.

2. **Сервисы:**
    - Тестируются основные сценарии и ошибки для всех методов.

### Запуск тестов

- Выполните команду:
  ```bash
  ./gradlew test
  ```

## Запуск приложения

1. Убедитесь, что PostgreSQL запущен и доступен.
2. Настройте файл `application.yml`.
3. Выполните команду:
   ```bash
   ./gradlew bootRun
   ```

